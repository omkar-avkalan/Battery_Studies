Fixing the SPI connection issue on raspberry pi 5 :(if not fixed do as previously it was, because it can harm spi communication issues)

*Source: Google AI mode*
A permanent white screen on the Raspberry Pi 5 usually indicates the display is receiving power (the backlight) but has lost communication with the SPI data lines or failed its initialization sequence. Because this happened after a script crash, the SPI bus or GPIO pins may be "locked" in an invalid state. 

1. The "Core Fix" for Pi 5 SPI Persistence

On the Raspberry Pi 5, the standard `dtparam=spi=on` can sometimes be unstable for certain TFT modules. A more robust way to ensure the SPI0 bus is correctly initialized for the RP1 chip is to use a specific overlay. 

1. Open your boot configuration file:
    
    bash
    
    ```
    sudo nano /boot/firmware/config.txt
    ```
    
    Use code with caution.
    
2. Find the line `dtparam=spi=on` and change it (or add this below it) to:
    
    text
    
    ```
    dtoverlay=spi0-1cs
    ```
    
    Use code with caution.
    
3. Save (**Ctrl+O**, **Enter**) and Exit (**Ctrl+X**).
4. **Reboot** the Pi immediately: `sudo reboot`.

5. Reset the SPI Hardware (Without Rebooting)

If the screen turns white after a script crashes, the SPI kernel module might be hung. You can force a hardware-level reset of the SPI driver while in your terminal:

bash

```
sudo modprobe -r spi_bcm2835
sudo modprobe spi_bcm2835
```

Use code with caution.

_Note: If `spi_bcm2835` is not found, try `sudo modprobe -r spi_rp1` as the Pi 5 uses the RP1 controller._ 

3. Check for "Ghost" Processes

If your previous SoC or EKF programs crashed but didn't "release" the GPIO pins, the new test program cannot take control of them.

1. Check for running Python processes: `ps aux | grep python`
2. Kill any lingering scripts: `sudo killall python3`
3. Run your `text_test.py` again.

4. Adjust the Initialization Delay

The Pi 5 is much faster than previous models. Sometimes it sends commands to the TFT before the display's own internal controller has finished waking up. Add an explicit reset pulse and delay in your Python code:

python

```
from luma.core.interface.serial import spi
from luma.lcd.device import st7735
import time
import RPi.GPIO as GPIO # Or the rpi-lgpio equivalent

# Manually trigger a hardware reset before initializing the library
reset_pin = 25
GPIO.setmode(GPIO.BCM)
GPIO.setup(reset_pin, GPIO.OUT)
GPIO.output(reset_pin, GPIO.LOW)
time.sleep(0.2)
GPIO.output(reset_pin, GPIO.HIGH)
time.sleep(0.2)

# Now initialize luma
serial = spi(port=0, device=0, gpio_DC=24, gpio_RST=25)
device = st7735(serial, width=128, height=128)
```

Use code with caution.

5. Hardware Troubleshooting

- **Loose Wires:** Even if they look connected, a crash can coincide with a wire being bumped. Re-seat the **DC** and **RST** wires specifically.
- **Power Sag:** Running EKF (Extended Kalman Filter) logic is CPU-intensive. If your power supply is weak, the voltage may drop enough to "brown out" the display's controller while the Pi stays running. Ensure you are using a high-quality 5V 5A power supply.